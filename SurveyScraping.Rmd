---
title: "Economist Survey Scraping"
author: "Nate Stephens"
date: "3/12/2020"
output: html_document
---

Basically this code shows the overall averages, and broken down by education level. I can add any of the other categories you guys want though; the only one I'm still working on is unfortunately one of the useful ones, party affiliation, because that part is sometimes cut off onto a second page and I haven't been able to extract that part as a single table yet, but I'm working on it.
```{r}
library(tidyverse)
library(pdftools)
library(rvest)
library(rJava)
Sys.setenv(JAVA_HOME="C:/Program Files/Java/jre1.8.0_241")
library(tabulizer)
```

Do you think the federal government should be increasing or decreasing the amount of money it spends on preventing the spread of infectious diseases, or do you think it currently spends about the right amount?
```{r}
#This grabs 33rd page of pdf
df_results <- extract_tables("https://docs.cdn.yougov.com/vrbl9mmctz/econTabReport.pdf", pages = 33)
#Obviously this table is incredibly messy, so the rest of the code is basically just reformatting stuff into a workable dataframe. Since it is so messy I've just been doing the different sections manually, so to speak.

#Education
df1 <- df_results[[1]] %>% as_tibble() 
  
df2 = df1 %>% unite(Education, 5:6, sep = " ") %>% 
  separate(V3, c("New1", "New2", "New3"), sep = " ") %>% 
  unite(Education, c(5,7), sep = " ")

x1 = df2$V1[1:8]
x2 = df2$V2[1:8]
x3 = df2$Education[1:8]

clean1 = tibble(x1,x2,x3)
#This is need due to the fact that one of the things is spread out over 2 rows
clean1[6,1] = paste(clean1[5,1],clean1[6,1])

clean1 = clean1[-c(5,1,2),]



cleaned.edu.table = clean1 %>% separate(col = x3, into = c("HS or less", "Some college", "College Grad", "Postgrad"), sep = " ") %>% rename(Total = x2)
cleaned.edu.table

#Gender
df3 = df1 %>% separate(V3, c("New1", "New2"), sep = " ")


x1 = df3$V1[1:8]
x2 = df3$V2[1:8]
x3 = df3$New1[1:8]
x4 = df3$New2[1:8]

clean1 = tibble(x1,x2,x3, x4)

clean1[6,1] = paste(clean1[5,1],clean1[6,1])
clean1 = clean1[-c(5,1,2),]

cleaned.gender.table = clean1 %>% rename(Total = x2, Male = x3, Female = x4)
cleaned.gender.table

#Income
df4 = df1 %>% unite(Income, 7:9, sep = " ")

x1 = df4$V1[1:8]
x2 = df4$V2[1:8]
x3 = df4$Income[1:8]

clean1 = tibble(x1,x2,x3)
#This is need due to the fact that one of the responses is spread out over 2 rows
clean1[6,1] = paste(clean1[5,1],clean1[6,1])

clean1 = clean1[-c(5,1,2),]



cleaned.income.table = clean1 %>% separate(col = x3, into = c("Under $50k", "$50-100K", "$100K or more"), sep = " ") %>% rename(Total = x2)
cleaned.income.table

#Age
df5 = df1 %>% 
  separate(V5, c("New1", "New2"), sep = " ") %>% 
  unite(Age, c(3,5), sep = " ")


x1 = df5$V1[9:16]
x2 = df5$V2[9:16]
x3 = df5$Age[9:16]

clean1 = tibble(x1,x2,x3)
#This is need due to the fact that one of the responses is spread out over 2 rows
clean1[6,1] = paste(clean1[5,1],clean1[6,1])

clean1 = clean1[-c(5,1,2),]



cleaned.age.table = clean1 %>% separate(col = x3, into = c("18-29", "30-44", "45-64", "65+"), sep = " ") %>% rename(Total = x2)
cleaned.age.table

#Race
df6 = df1 %>% 
  separate(V5, c("New1", "New2", "New3", "New4"), sep = " ") %>% 
  unite(Race, 6:9, sep = " ")


x1 = df6$V1[9:16]
x2 = df6$V2[9:16]
x3 = df6$Race[9:16]

clean1 = tibble(x1,x2,x3)
#This is need due to the fact that one of the responses is spread out over 2 rows
clean1[6,1] = paste(clean1[5,1],clean1[6,1])

clean1 = clean1[-c(5,1,2),]



cleaned.race.table = clean1 %>% separate(col = x3, into = c("White", "Black", "Hispanic", "Other"), sep = " ") %>% rename(Total = x2)
cleaned.race.table

#Region
df7 = df1 %>% 
  unite(Region, 7:9, sep = " ")


x1 = df7$V1[9:16]
x2 = df7$V2[9:16]
x3 = df7$Region[9:16]

clean1 = tibble(x1,x2,x3)
#This is need due to the fact that one of the responses is spread out over 2 rows
clean1[6,1] = paste(clean1[5,1],clean1[6,1])

clean1 = clean1[-c(5,1,2),]



cleaned.region.table = clean1 %>% separate(col = x3, into = c("Northeast", "Midwest", "South", "West"), sep = " ") %>% rename(Total = x2)
cleaned.region.table
```



Do you approve or disapprove of Donald Trump placing Vice President Mike Pence in charge of the federal government’s response to the spread of the coronavirus?

```{r}

df_results2 <- extract_tables("https://docs.cdn.yougov.com/vrbl9mmctz/econTabReport.pdf", pages = 31:32)
first_df <- df_results2[[1]] %>% as_tibble() %>%
  unite(Education, 5:6, sep = " ") %>% 
  unite(V8, 7:8, sep = " ")

x1 = first_df$V1[1:7]
x2 = first_df$V2[1:7]
x3 = first_df$Education[1:7]

clean1 = tibble(x1,x2,x3)  

clean2 = clean1[-c(1,2),]
#""
cleanedquestion2 = clean2 %>% separate(col = x3, into = c("Some college", "College Grad", "Postgrad"), sep = c(" "))%>% rename(Total = x2)
cleanedquestion2
#The above part is fine because all the college stuff is on one page

#This part is tricky and I haven't figured out a good way to extract and combine the tables from 2 different pages of the pdf
#Second half of party breakdown, only has 3 of the options
test2 = rbind(first_df, second_df)
second_df <- df_results2[[2]] %>% as_tibble() %>% 
  unite(V4, 4:5, sep = " ")

x1 = second_df$V1[1:6]
x2 = second_df$V2[1:6]
x3 = second_df$V4[1:6]

(clean1 = tibble(x1,x2,x3))

clean2 = clean1[-c(1,2,3),]
clean2
cleanedquestion3 = clean2 %>% separate(col = x3, into = c("Dem", "Rep", "Dem2","Ind","Rep2"), sep = c(" "))%>% rename(Total = x2)
cleanedquestion3
```








How concerned are you about a coronavirus epidemic here in the United States?
```{r}
#This grabs correct page of pdf
df_results <- extract_tables("https://docs.cdn.yougov.com/vrbl9mmctz/econTabReport.pdf", pages = 35)
df4 <- df_results[[1]] %>% as_tibble()

df4 = df4 %>% unite(Education, 5:6, sep = " ")

x1 = df4$V1[1:6]
x2 = df4$V2[1:6]
x3 = df4$Education[1:6]

(clean1 = tibble(x1,x2,x3))

clean2 = clean1[-c(1,2),]
clean2

#""
cleanedquestion4 = clean2 %>% separate(col = x3, into = c("Some college", "College Grad", "Postgrad"), sep = c(" "))%>% rename(Total = x2)
cleanedquestion4

```

Favorability of politicians — Joe Biden
Do you have a favorable or an unfavorable opinion of the following people?
```{r}
#This grabs correct page of pdf
df_results <- extract_tables("https://docs.cdn.yougov.com/vrbl9mmctz/econTabReport.pdf", pages = 78)
df5 <- df_results[[1]] %>% as_tibble()

df5 = df5 %>% unite(Education, 5:6, sep = " ")

x1 = df5$V1[1:7]
x2 = df5$V2[1:7]
x3 = df5$Education[1:7]

(clean1 = tibble(x1,x2,x3))

clean2 = clean1[-c(1,2),]
clean2

#""
cleanedquestion4 = clean2 %>% separate(col = x3, into = c("Some college", "College Grad", "Postgrad"), sep = c(" "))%>% rename(Total = x2)
cleanedquestion4

```

```{r}
#Miscellaeneous Scrap code

#This cleans out the extra spaces from the binding, if necessary
df2$Education = gsub("\\s+"," ", df2$Education)

```

